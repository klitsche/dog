# Enrichers

## How do they work?

Enrichers can add extra data to a data holder. Supported data holders are:

* `Project`
* `File`
* `Class_`
* `Trait_`
* `Interface_`
* `Constant`
* `Property`
* `Method`
* `Function_`
* `Argument` 

Enrichers come with a 3 phase process:

### 1. Create

Before `dog` parses all project files each enricher is initialized by calling `create(string $id, ConfigurationInterface $config)` to set its `id` and the current dog configuration.

### 2. Prepare

After the initializing all enrichers `prepare()` is called for each enricher.

In this phase enricher should validate its configuration, then gather and prepare data that is later on needed to enrich data holders.
Typical preparation tasks are reading and parsing files from processes ran before dog.

### 3: Enrich

After `dog` did build the `Project` each enricher then visits all `Project` related data holders.

In this Phase enricher can add data be calling `setData(string $id, $value)` on the data holder.
Using the enricher id here is best practise.

!!! Note
    All enricher first visit the project and then the elements. 
    
## Access Data in Templates

Enriched data can be accessed be calling `getData(string $id)` on `Project` or `Element` items - eg for the PHPLOCEnricher:

```twig
{% for key, value in project.data('phploc') %}
{{ '* '~key }}{{ ' = '~value }}
{% endfor %}
```

## Bundled Enricher

### clover

Reads and parser test coverage clover xml file generated by tools like [phpunit](https://phpunit.de/) and 
[codeception](https://codeception.com/). 

Added data:
 
* `Project` with `\Klitsche\Dog\Enrichers\Clover\ProjectMetrics`
* `Class` and `Trait` with `\Klitsche\Dog\Enrichers\Clover\ClassMetrics`
* `Method` with `\Klitsche\Dog\Enrichers\Clover\MethodMetrics`

Your have to run your tests with coverage upfront - eg.:

```bash
vendor/bin/phpunit --coverage-clover=clover.xml
```

Configure like:

```yaml
enrichers:
  phploc:
    class: \Klitsche\Dog\Enrichers\Clover\CloverEnricher
    file: clover.xml
```

### phploc

Reads and parser the json output file generated by [phploc](https://github.com/sebastianbergmann/phploc).
 
Data added:

* `Project` with json decoded result

Your have to run phploc upfront - eg. like:

```bash
php phploc.phar --log-json=phploc.json src
```

Configure like:

```yaml
enrichers:
  phploc:
    class: \Klitsche\Dog\Enrichers\PHPLOC\PHPLOCEnricher
    file: phploc.json
```

See  for more details on phploc.

## Custom enricher

* A Enricher must implement `Klitsche\Dog\Enrichers\EnricherInterface`
* Best practise: enricher extends the abstract class `Klitsche\Dog\Enrichers\Enricher`
* Data holders must implement `Klitsche\Dog\Enrichers\DataAwareInterface`
* Best practise: use its enricher id to add extra data to data holders
* Extra data can be scalar values or objects